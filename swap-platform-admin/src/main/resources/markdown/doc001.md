# 闲置物品交换平台后端接口开发文档

## 一、系统概述
基于提供的SQL结构，本平台为C2C闲置物品交换系统，支持用户注册登录、物品发布、置换交易、评论互动、收藏关注等功能。系统包含三种角色：**普通用户**、**卖家**、**管理员**。

---

## 二、通用规范

### 2.1 基础信息
- **Base URL**: `http://localhost:8080/swap_platform/api`
- **协议**: HTTP/HTTPS
- **数据格式**: JSON
- **编码**: UTF-8

### 2.2 认证机制
- 使用Token-based认证
- 登录后获取Token，后续请求需在Header中携带：`Authorization: Bearer {token}`
- Token存储于`userToken`表，包含过期时间

### 2.3 通用响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data: {...}
}
```

### 2.4 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权/Token无效 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 三、接口模块

### 模块一：用户认证管理

#### 1. 用户注册
- **接口**: `POST /auth/register`
- **描述**: 普通用户注册
- **请求参数**:
```json
{
  "username": "user01",
  "password": "123456",
  "realName": "王芳",
  "gender": "女",
  "phone": "13900000000",
  "email": "wangfang@qq.com",
  "photo": "http://example.com/photo.jpg"
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "注册成功",
  "data: {
    "userId": 1614756771094,
    "username": "user01",
    "token": "fasbtyj61yfp1t3ecbce3i51yo5ux5qf"
  }
}
```

#### 2. 卖家注册
- **接口**: `POST /auth/seller/register`
- **描述**: 卖家注册
- **请求参数**:
```json
{
  "sellerName": "seller01",
  "password": "123456",
  "realName": "李伟",
  "gender": "女",
  "phone": "13800000000",
  "email": "liwei@qq.com",
  "photo": "http://example.com/liwei.jpg"
}
```
- **响应数据**: 同用户注册

#### 3. 用户登录
- **接口**: `POST /auth/login`
- **描述**: 通用登录接口（用户/卖家/管理员）
- **请求参数**:
```json
{
  "username": "user01",
  "password": "123456",
  "userType": "user" // 可选值: user, seller, admin
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data: {
    "userId": 1614756771094,
    "username": "user01",
    "role": "用户",
    "token": "fasbtyj61yfp1t3ecbce3i51yo5ux5qf",
    "expireTime": "2025-03-03T00:37:34"
  }
}
```

#### 4. 退出登录
- **接口**: `POST /auth/logout`
- **描述**: 用户退出登录
- **请求头**: `Authorization: Bearer {token}`
- **响应数据**:
```json
{
  "code": 200,
  "message": "退出成功"
}
```

---

### 模块二：用户信息管理

#### 5. 获取个人信息
- **接口**: `GET /user/profile`
- **描述**: 获取当前登录用户信息
- **请求头**: `Authorization: Bearer {token}`
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "id": 1614756771094,
    "username": "user01",
    "realName": "王芳",
    "gender": "女",
    "phone": "13900000000",
    "email": "wangfang@qq.com",
    "photo": "http://localhost:8080/swap_platform/upload/wangfang.jpg",
    "addTime": "2025-03-03T07:32:51"
  }
}
```

#### 6. 更新个人信息
- **接口**: `PUT /user/profile`
- **描述**: 更新个人信息
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "realName": "王芳",
  "gender": "女",
  "phone": "13911111111",
  "email": "wangfang@qq.com",
  "photo": "http://example.com/new_photo.jpg"
}
```
- **响应数据**: 更新成功提示

#### 7. 修改密码
- **接口**: `PUT /user/password`
- **描述**: 修改登录密码
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "oldPassword": "123456",
  "newPassword": "654321"
}
```

---

### 模块三：物品分类管理

#### 8. 获取物品分类列表
- **接口**: `GET /categories`
- **描述**: 获取所有旧物类型
- **响应数据**:
```json
{
  "code": 200,
  "data: [
    {"id": 31, "categoryName": "图书", "addTime": "2025-03-03T07:22:20"},
    {"id": 1614756385820, "categoryName": "衣服", "addTime": "2025-03-03T07:26:25"},
    {"id": 1614756639180, "categoryName": "手机", "addTime": "2025-03-03T07:30:39"},
    {"id": 1614756645515, "categoryName": "鞋子", "addTime": "2025-03-03T07:30:45"},
    {"id": 1614756652240, "categoryName": "箱包", "addTime": "2025-03-03T07:30:51"}
  ]
}
```

#### 9. 新增分类（管理员）
- **接口**: `POST /categories`
- **描述**: 添加新物品分类
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）
- **请求参数**:
```json
{
  "category": "电子产品"
}
```

---

### 模块四：旧物信息管理

#### 10. 发布旧物信息
- **接口**: `POST /items`
- **描述**: 卖家发布旧物信息
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "itemName": "粉色运动鞋",
  "itemCategory": "鞋子",
  "itemImage": "http://localhost:8080/swap_platform/upload/pink_shoes.jpg",
  "exchangeRequest": "想换一双黑色运动鞋",
  "itemDetail": "<p>九成新，Size 38</p>",
  "contactName": "李伟",
  "contactPhone": "13800000000"
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "发布成功",
  "data: {
    "itemId": 1614756710816
  }
}
```

#### 11. 获取旧物列表
- **接口**: `GET /items`
- **描述**: 分页获取旧物列表，支持筛选
- **查询参数**:
  - `page`: 页码，默认1
  - `size`: 每页数量，默认10
  - `category`: 分类名称（可选）
  - `keyword`: 关键词搜索（可选）
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "total": 2,
    "page": 1,
    "size": 10,
    "list": [
      {
        "id": 1614756710816,
        "itemName": "粉色运动鞋",
        "itemCategory": "鞋子",
        "itemImage": "http://localhost:8080/swap_platform/upload/pink_shoes.jpg",
        "exchangeRequest": "想换一双黑色运动鞋",
        "likeCount": 0,
        "dislikeCount": 0,
        "addTime": "2025-03-03T07:31:50",
        "sellerName": "seller01"
      }
    ]
  }
}
```

#### 12. 获取旧物详情
- **接口**: `GET /items/{itemId}`
- **描述**: 获取单个旧物详细信息
- **路径参数**: `itemId`
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "id": 1614756747286,
    "itemName": "华为P30",
    "itemCategory": "手机",
    "itemImage": "http://localhost:8080/swap_platform/upload/huawei_phone.jpg",
    "exchangeRequest": "可换小米或三星同级机型",
    "itemDetail": "<p>128G，完好无磕碰</p>",
    "likeCount": 2,
    "dislikeCount": 0,
    "sellerName": "seller01",
    "contactName": "李伟",
    "contactPhone": "13800000000",
    "addTime": "2025-03-03T07:32:26"
  }
}
```

#### 13. 更新旧物信息
- **接口**: `PUT /items/{itemId}`
- **描述**: 卖家更新自己发布的旧物信息
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**: 同发布接口

#### 14. 删除旧物信息
- **接口**: `DELETE /items/{itemId}`
- **描述**: 卖家删除自己发布的旧物
- **请求头**: `Authorization: Bearer {token}`

#### 15. 点赞/点踩旧物
- **接口**: `POST /items/{itemId}/reaction`
- **描述**: 用户对旧物点赞或点踩
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "type": "like" // 或 "dislike"
}
```

---

### 模块五：评论管理

#### 16. 发布评论
- **接口**: `POST /comments`
- **描述**: 用户对旧物发表评论
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "itemId": 1614756747286,
  "content": "想用小米11换，可以吗？"
}
```

#### 17. 获取评论列表
- **接口**: `GET /comments`
- **描述**: 获取指定旧物的评论列表
- **查询参数**:
  - `itemId`: 旧物ID（必填）
  - `page`: 页码
  - `size`: 每页数量
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "total": 3,
    "list": [
      {
        "id": 1614756859734,
        "itemId": 1614756747286,
        "userId": 1614756771094,
        "username": "user01",
        "content": "想用小米11换，可以吗？",
        "reply": null,
        "addTime": "2025-03-03T07:34:19"
      }
    ]
  }
}
```

#### 18. 回复评论（卖家）
- **接口**: `PUT /comments/{commentId}/reply`
- **描述**: 卖家回复用户评论
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "reply": "可以私聊详谈"
}
```

---

### 模块六：收藏管理

#### 19. 添加收藏
- **接口**: `POST /favorites`
- **描述**: 用户收藏旧物
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "itemId": 1614756747286,
  "itemType": "手机",
  "name": "华为P30",
  "image": "http://localhost:8080/swap_platform/upload/huawei_phone.jpg"
}
```

#### 20. 获取收藏列表
- **接口**: `GET /favorites`
- **描述**: 获取当前用户的收藏列表
- **请求头**: `Authorization: Bearer {token}`
- **查询参数**: `page`, `size`
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "total": 1,
    "list": [
      {
        "id": 1614756851014,
        "itemId": 1614756747286,
        "itemType": "手机",
        "name": "华为P30",
        "image": "http://localhost:8080/swap_platform/upload/huawei_phone.jpg",
        "addTime": "2025-03-03T07:34:10"
      }
    ]
  }
}
```

#### 21. 取消收藏
- **接口**: `DELETE /favorites/{favoriteId}`
- **描述**: 删除收藏
- **请求头**: `Authorization: Bearer {token}`

---

### 模块七：置换交易管理

#### 22. 发起置换申请
- **接口**: `POST /exchange-deals`
- **描述**: 用户向卖家发起物品置换申请
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "targetItemId": 1614756747286,
  "offerItemName": "小米11",
  "offerItemImage": "http://localhost:8080/swap_platform/upload/xiaomi_phone.jpg",
  "offerDetail": "<p>小米11，128G，成色99新</p>"
}
```

#### 23. 获取置换交易列表
- **接口**: `GET /exchange-deals`
- **描述**: 获取用户的置换交易记录
- **请求头**: `Authorization: Bearer {token}`
- **查询参数**:
  - `role`: 角色（user/seller），用于区分是发起的申请还是收到的申请
  - `approved`: 审核状态（可选）
- **响应数据**:
```json
{
  "code": 200,
  "data: [
    {
      "id": 1614756898631,
      "username": "user01",
      "realName": "王芳",
      "phone": "13900000000",
      "targetItemName": "华为P30",
      "targetItemImage": "http://localhost:8080/swap_platform/upload/huawei_phone.jpg",
      "offerItemName": "小米11",
      "offerItemImage": "http://localhost:8080/swap_platform/upload/xiaomi_phone.jpg",
      "offerDetail": "<p>小米11，128G，成色99新</p>",
      "approved": "是",
      "approvalReply": "同意置换，请尽快联系对方完成交易。",
      "addTime": "2025-03-03T07:34:58"
    }
  ]
}
```

#### 24. 审核置换申请（卖家）
- **接口**: `PUT /exchange-deals/{dealId}/approve`
- **描述**: 卖家审核置换申请
- **请求头**: `Authorization: Bearer {token}`
- **请求参数**:
```json
{
  "approved": "是",
  "approvalReply": "同意置换，请尽快联系对方完成交易。"
}
```

---

### 模块八：公告管理

#### 25. 获取公告列表
- **接口**: `GET /announcements`
- **描述**: 获取平台公告列表
- **查询参数**: `page`, `size`
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "total": 2,
    "list": [
      {
        "id": 1614756590323,
        "title": "新功能上线",
        "introduction": "现已支持多张图片上传",
        "image": "http://localhost:8080/swap_platform/upload/feature.jpg",
        "content": "<p>发布旧物时，可一次性上传多张图片，让物品展示更全面。</p>",
        "addTime": "2025-03-03T07:29:49"
      }
    ]
  }
}
```

#### 26. 获取公告详情
- **接口**: `GET /announcements/{announcementId}`
- **描述**: 获取单个公告详情

#### 27. 发布公告（管理员）
- **接口**: `POST /announcements`
- **描述**: 管理员发布公告
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）

---

### 模块九：系统配置管理

#### 28. 获取Banner配置
- **接口**: `GET /config/banners`
- **描述**: 获取首页轮播图配置
- **响应数据**:
```json
{
  "code": 200,
  "data: [
    {
      "name": "banner1",
      "value": "http://localhost:8080/swap_platform/upload/banner1.png"
    },
    {
      "name": "banner2",
      "value": "http://localhost:8080/swap_platform/upload/banner2.jpg"
    }
  ]
}
```

#### 29. 更新配置（管理员）
- **接口**: `PUT /config/{configName}`
- **描述**: 更新系统配置
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）

---

## 四、管理员专属接口

### 模块十：后台管理

#### 30. 获取用户列表（管理员）
- **接口**: `GET /admin/users`
- **描述**: 管理员查看所有用户信息
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）

#### 31. 管理员审核物品
- **接口**: `PUT /admin/items/{itemId}/audit`
- **描述**: 管理员审核发布的旧物信息
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）

#### 32. 管理员删除评论
- **接口**: `DELETE /admin/comments/{commentId}`
- **描述**: 管理员删除违规评论
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）

#### 33. 数据统计接口
- **接口**: `GET /admin/statistics`
- **描述**: 管理员获取平台数据统计
- **请求头**: `Authorization: Bearer {token}`（需管理员权限）
- **响应数据**:
```json
{
  "code": 200,
  "data: {
    "totalUsers": 100,
    "totalSellers": 50,
    "totalItems": 200,
    "totalDeals": 30
  }
}
```

---

## 五、接口使用示例

### 完整流程示例：用户置换物品

1. **用户登录** → 获取Token
2. **浏览物品列表** → `GET /items`
3. **查看物品详情** → `GET /items/1614756747286`
4. **发表意向评论** → `POST /comments`
5. **发起置换申请** → `POST /exchange-deals`
6. **查看申请状态** → `GET /exchange-deals`

---

## 六、注意事项

1. **图片上传**: 所有图片字段需先调用文件上传接口获取URL
2. **权限控制**: 卖家只能操作自己的物品，普通用户只能操作自己的收藏和评论
3. **Token刷新**: Token过期前需重新登录获取新Token
4. **数据安全**: 手机号等敏感信息在列表接口中应脱敏处理
5. **分页参数**: 所有列表接口默认page=1, size=10，最大size不超过50

---

## 七、数据库约束说明

1. **唯一约束**: `seller.sellerName`, `user.username` 唯一
2. **外键关联**: 业务层需保证`itemInfo.sellerName`, `itemComments.itemId`, `favorites.itemId`等字段引用有效性
3. **默认值**: `addTime`默认当前时间，`likeCount/dislikeCount`默认0，`approved`默认"否"

---

**文档版本**: v1.0  
**更新时间**: 2025-12-11  
**适用环境**: 开发/测试环境